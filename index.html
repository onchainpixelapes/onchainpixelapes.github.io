<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>OnChainPixelApes Mint</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.cdnfonts.com/css/press-start-2p" rel="stylesheet">
  <style>
    body {
      background: #1b2838;
      font-family: 'Press Start 2P', monospace;
      margin: 0;
      padding: 0;
      color: #e3e3ee;
    }
    .navbar {
      background: #23304a;
      border-bottom: 4px solid #00e0ff;
      padding: 0;
      margin: 0;
      box-shadow: 0 2px 0 #00e0ff, 0 4px 0 #222;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .navbar-logo {
      font-size: 1.3em;
      color: #00e0ff;
      padding: 20px 24px;
      letter-spacing: 2px;
      text-shadow: 2px 2px #004d6e;
      user-select: none;
    }
    .navbar-links {
      display: flex;
      gap: 24px;
      margin-right: 32px;
    }
    .navbar-links a {
      color: #e3e3ee;
      text-decoration: none;
      font-size: 0.9em;
      padding: 8px 0;
      border-bottom: 2px solid transparent;
      transition: border 0.15s;
    }
    .navbar-links a:hover {
      color: #00e0ff;
      border-bottom: 2px solid #00e0ff;
    }

    .pixel-box {
      background: #232b3a;
      border: 4px solid #00e0ff;
      border-radius: 0;
      margin: 42px auto 0 auto;
      max-width: 390px;
      box-shadow: 0 0 0 6px #2c476a, 0 8px 0 #111;
      padding: 32px 28px 28px 28px;
      position: relative;
      z-index: 2;
    }
    h2 {
      text-align: center;
      color: #00e0ff;
      font-size: 1.1em;
      margin-top: 0;
      letter-spacing: 1px;
      text-shadow: 1px 1px #004d6e;
    }
    .info {
      color: #98e5fe;
      font-size: 0.77em;
      margin-bottom: 7px;
      letter-spacing: 1.5px;
    }
    .label {
      display:inline-block;
      min-width: 150px;
    }
    .supplybar {
      background: #2c476a;
      border: 2px solid #00e0ff;
      border-radius: 0;
      height: 10px;
      margin: 7px 0 10px 0;
      width: 100%;
      overflow: hidden;
    }
    .supplyfill {
      background: linear-gradient(90deg, #00e0ff 70%, #61f8ff 100%);
      height: 10px;
      border-radius: 0;
      transition: width 0.2s;
    }
    .mint-amount {
      display: flex;
      align-items: center;
      gap: 14px;
      margin: 10px 0;
    }
    .mint-btns {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 3px;
    }
    .mint-btns button {
      font-family: inherit;
      font-size: 1.1em;
      background: #232b3a;
      color: #00e0ff;
      border: 2px solid #00e0ff;
      border-radius: 0;
      padding: 3px 10px 4px 10px;
      cursor: pointer;
      transition: background 0.13s, color 0.13s;
      margin: 0 2px;
      box-shadow: 2px 2px 0 #004d6e;
    }
    .mint-btns button:active {
      background: #00e0ff;
      color: #232b3a;
      box-shadow: none;
    }
    input[type=number] {
      width: 62px;
      font-family: inherit;
      font-size: 1em;
      padding: 3px 0 3px 7px;
      background: #232b3a;
      color: #00e0ff;
      border: 2px solid #00e0ff;
      border-radius: 0;
      margin-left: 5px;
    }
    button {
      font-family: inherit;
      font-size: 1em;
    }
    #mintBtn {
      width: 100%;
      margin-top: 13px;
      margin-bottom: 4px;
      background: #00e0ff;
      color: #131e2d;
      border: 2px solid #00e0ff;
      box-shadow: 2px 2px 0 #004d6e;
      font-size: 1.1em;
      font-weight: bold;
      letter-spacing: 2px;
      padding: 12px 0 10px 0;
      border-radius: 0;
      cursor: pointer;
      transition: background 0.15s, color 0.13s;
    }
    #mintBtn:active {
      background: #131e2d;
      color: #00e0ff;
      box-shadow: none;
    }
    .success { color:#7fff8f; margin: 10px 0 0 0; }
    .error { color:#ff7f7f; margin: 10px 0 0 0; }
    .pixel-footer {
      text-align: center;
      color: #51e6ff;
      margin-top: 56px;
      font-size: 0.8em;
      opacity: 0.7;
      letter-spacing: 1px;
      text-shadow: 1px 1px #003e5e;
    }
    @media (max-width: 600px) {
      .pixel-box { max-width: 98vw; padding: 15px 7px 10px 7px;}
      .navbar-logo { font-size: 0.8em; padding: 12px 10px; }
      .navbar-links { gap: 8px; margin-right: 10px; }
      .label { min-width: 90px;}
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="navbar-logo">ü¶ç PIXEL APES</div>
    <div class="navbar-links">
      <a href="#">Home</a>
      <a href="https://basescan.org/address/0xe84481fc4f17516cbea3afdcae4150e4368474fe">Basescan</a>
      <a href="https://opensea.io/collection/onchainpixelapes">Opensea</a>
    </div>
  </nav>
  <div class="pixel-box">
    <h2>Mint your OnChainPixelApe</h2>
    <div class="info"><span class="label">Total Supply:</span>
      <span id="supplyInfo"></span>
      <div class="supplybar"><div id="supplyFill" class="supplyfill"></div></div>
    </div>
    <div class="info"><span class="label">Free Mint Supply Left:</span> <span id="freeSupplyInfo"></span></div>
    <div class="mint-amount">
      <span class="label">Mint Amount:</span>
      <div class="mint-btns">
        <button type="button" onclick="changeAmount(-1)">-</button>
        <input id="mintAmount" type="number" min="1" max="20" value="1" onchange="updatePrice()">
        <button type="button" onclick="changeAmount(1)">+</button>
      </div>
    </div>
    <div class="info"><span class="label">Total ETH to Pay:</span> <span id="totalEth"></span></div>
    <div id="wallet-section">
      <button id="connectBtn" onclick="connectWallet()">Connect Wallet</button>
    </div>
    <div id="user-section" style="display:none;">
      <div class="info"><span class="label">Wallet:</span> <span id="userAddress"></span></div>
      <div class="info"><span class="label">Your Free Mint Left:</span> <span id="userFreeInfo"></span></div>
      <div class="info"><span class="label">Paid Mint Amount:</span> <span id="paidAmount"></span></div>
      <button id="mintBtn" onclick="mint()">MINT</button>
      <div id="mintStatus"></div>
    </div>
  </div>
  <div class="pixel-footer">
    Made with üñ§ & pixel art style. Powered by Base.
  </div>
<script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
<script>
const CONTRACT_ADDRESS = "0xe84481fc4f17516cbea3afdcae4150e4368474fe"; 
const ABI = [{"inputs":[{"internalType":"address","name":"initialOwner","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"ApprovalCallerNotOwnerNorApproved","type":"error"},{"inputs":[],"name":"ApprovalQueryForNonexistentToken","type":"error"},{"inputs":[],"name":"BalanceQueryForZeroAddress","type":"error"},{"inputs":[{"internalType":"uint256","name":"numerator","type":"uint256"},{"internalType":"uint256","name":"denominator","type":"uint256"}],"name":"ERC2981InvalidDefaultRoyalty","type":"error"},{"inputs":[{"internalType":"address","name":"receiver","type":"address"}],"name":"ERC2981InvalidDefaultRoyaltyReceiver","type":"error"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"numerator","type":"uint256"},{"internalType":"uint256","name":"denominator","type":"uint256"}],"name":"ERC2981InvalidTokenRoyalty","type":"error"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"address","name":"receiver","type":"address"}],"name":"ERC2981InvalidTokenRoyaltyReceiver","type":"error"},{"inputs":[],"name":"MintERC2309QuantityExceedsLimit","type":"error"},{"inputs":[],"name":"MintToZeroAddress","type":"error"},{"inputs":[],"name":"MintZeroQuantity","type":"error"},{"inputs":[],"name":"NotCompatibleWithSpotMints","type":"error"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"OwnableInvalidOwner","type":"error"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"OwnableUnauthorizedAccount","type":"error"},{"inputs":[],"name":"OwnerQueryForNonexistentToken","type":"error"},{"inputs":[],"name":"OwnershipNotInitializedForExtraData","type":"error"},{"inputs":[],"name":"SequentialMintExceedsLimit","type":"error"},{"inputs":[],"name":"SequentialUpToTooSmall","type":"error"},{"inputs":[],"name":"SpotMintTokenIdTooSmall","type":"error"},{"inputs":[],"name":"TokenAlreadyExists","type":"error"},{"inputs":[],"name":"TransferCallerNotOwnerNorApproved","type":"error"},{"inputs":[],"name":"TransferFromIncorrectOwner","type":"error"},{"inputs":[],"name":"TransferToNonERC721ReceiverImplementer","type":"error"},{"inputs":[],"name":"TransferToZeroAddress","type":"error"},{"inputs":[],"name":"URIQueryForNonexistentToken","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"uint256","name":"fromTokenId","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"toTokenId","type":"uint256"},{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"}],"name":"ConsecutiveTransfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[],"name":"FREE_MINT_SUPPLY","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_FREE_MINT_PER_WALLET","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MAX_SUPPLY","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"MINT_PRICE","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"freeMintedCount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"quantity","type":"uint256"}],"name":"mint","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"uint256","name":"salePrice","type":"uint256"}],"name":"royaltyInfo","outputs":[{"internalType":"address","name":"receiver","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"_data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"receiver","type":"address"},{"internalType":"uint96","name":"feeNumerator","type":"uint96"}],"name":"setRoyalty","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"result","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"withdraw","outputs":[],"stateMutability":"nonpayable","type":"function"}];

let web3;
let contract;
let accounts = [];
let maxSupply = 2222;
let freeMintSupply = 500;
let mintPrice = 0.01;
let maxFreePerWallet = 2;
let totalSupply = 0;
let userFreeMinted = 0;

// Optionally, you can set a BASE RPC for read-only view when wallet not connected
const BASE_RPC = "https://mainnet.base.org";

// Load global supply info on page load
window.addEventListener('DOMContentLoaded', async () => {
  try {
    web3 = new Web3(BASE_RPC);
    contract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);
    [maxSupply, freeMintSupply, mintPrice] = await Promise.all([
      contract.methods.MAX_SUPPLY().call(),
      contract.methods.FREE_MINT_SUPPLY().call(),
      contract.methods.MINT_PRICE().call(),
    ]);
    mintPrice = parseFloat(web3.utils.fromWei(mintPrice, "ether"));
    await fetchGlobalData();
  } catch (e) {
    document.getElementById("supplyInfo").innerText = "‚Äî";
    document.getElementById("freeSupplyInfo").innerText = "‚Äî";
    document.getElementById("totalEth").innerText = "‚Äî";
  }
});

async function fetchGlobalData() {
  try {
    totalSupply = await contract.methods.totalSupply().call();
    document.getElementById("supplyInfo").innerText = `${totalSupply} / ${maxSupply}`;
    let supplyPercent = Math.round(100 * totalSupply / maxSupply);
    document.getElementById("supplyFill").style.width = supplyPercent + "%";
    let freeLeft = freeMintSupply - totalSupply;
    if (freeLeft < 0) freeLeft = 0;
    document.getElementById("freeSupplyInfo").innerText = `${freeLeft}`;
    updatePrice();
  } catch (e) {
    document.getElementById("supplyInfo").innerText = "‚Äî";
    document.getElementById("freeSupplyInfo").innerText = "‚Äî";
  }
}

function changeAmount(delta) {
  const input = document.getElementById("mintAmount");
  let value = parseInt(input.value) || 1;
  value += delta;
  if (value < 1) value = 1;
  if (value > 20) value = 20;
  input.value = value;
  updatePrice();
}

async function connectWallet() {
  if (window.ethereum === undefined) {
    alert("Please install Metamask!");
    return;
  }
  web3 = new Web3(window.ethereum);
  try {
    await switchToBase();
    accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
    document.getElementById("userAddress").innerText = accounts[0];
    contract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);

    // Read contract parameters for user
    [maxFreePerWallet, userFreeMinted] = await Promise.all([
      contract.methods.MAX_FREE_MINT_PER_WALLET().call(),
      contract.methods.freeMintedCount(accounts[0]).call()
    ]);
    document.getElementById("wallet-section").style.display = "none";
    document.getElementById("user-section").style.display = "";
    fetchUserData();
  } catch (e) {
    alert("Wallet connection rejected.");
  }
}

const BASE_PARAMS = {
  chainId: "0x2105", // 8451 in hex
  chainName: "Base Mainnet",
  nativeCurrency: {
    name: "Ethereum",
    symbol: "ETH",
    decimals: 18
  },
  rpcUrls: ["https://mainnet.base.org"],
  blockExplorerUrls: ["https://basescan.org"]
};

async function switchToBase() {
  const provider = window.ethereum;
  if (!provider) return;
  try {
    await provider.request({
      method: "wallet_switchEthereumChain",
      params: [{ chainId: BASE_PARAMS.chainId }]
    });
  } catch (err) {
    // Chain not added to MetaMask
    if (err.code === 4902) {
      await provider.request({
        method: "wallet_addEthereumChain",
        params: [BASE_PARAMS]
      });
    } else {
      throw err;
    }
  }
}

async function fetchUserData() {
  userFreeMinted = await contract.methods.freeMintedCount(accounts[0]).call();
  let userFreeLeft = maxFreePerWallet - userFreeMinted;
  if (userFreeLeft < 0) userFreeLeft = 0;
  document.getElementById("userFreeInfo").innerText = `${userFreeLeft}`;
  updatePrice();
}

function updatePrice() {
  const mintAmount = parseInt(document.getElementById("mintAmount").value) || 1;
  let freeLeft = freeMintSupply - totalSupply;
  if (freeLeft < 0) freeLeft = 0;
  let userFreeLeft = (typeof userFreeMinted !== "undefined") ? (maxFreePerWallet - userFreeMinted) : maxFreePerWallet;
  if (userFreeLeft < 0) userFreeLeft = 0;
  let freeQty = Math.min(mintAmount, freeLeft, userFreeLeft);
  let paidQty = mintAmount - freeQty;
  document.getElementById("totalEth").innerText = (paidQty * mintPrice).toFixed(4);
  if(document.getElementById("paidAmount")) document.getElementById("paidAmount").innerText = paidQty;
}

async function mint() {
  const mintStatus = document.getElementById("mintStatus");
  mintStatus.innerText = "";
  mintStatus.className = "";
  const mintAmount = parseInt(document.getElementById("mintAmount").value) || 1;

  let freeLeft = freeMintSupply - totalSupply;
  if (freeLeft < 0) freeLeft = 0;
  let userFreeLeft = maxFreePerWallet - userFreeMinted;
  if (userFreeLeft < 0) userFreeLeft = 0;
  let freeQty = Math.min(mintAmount, freeLeft, userFreeLeft);
  let paidQty = mintAmount - freeQty;
  let totalCost = web3.utils.toWei((paidQty * mintPrice).toString(), "ether");

  try {
    mintStatus.innerText = "Minting in progress...";
    await contract.methods.mint(mintAmount).send({ from: accounts[0], value: totalCost });
    mintStatus.innerText = `Mint successful!`;
    mintStatus.className = "success";
    await fetchGlobalData();
    await fetchUserData();
  } catch (e) {
    mintStatus.innerText = "Mint failed: " + (e?.message || e);
    mintStatus.className = "error";
  }
}
</script>
</body>
</html>